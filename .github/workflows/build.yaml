name: Build docker image and push to ghcr.io
on:
    push:
        branches:
        - main

permissions:
    contents: read

jobs:
    build:
        runs-on: ubuntu-latest
        name: Build
        steps:
        - name: ðŸ”” Checkout Code
          uses: actions/checkout@v4
          with:
            fetch-depth: 0

        - name: ðŸ”§ Setup Go
          uses: actions/setup-go@v5
          with:
            go-version: '1.21'
            cache: false

        - name: âœ¨ Login to GitHub Container Registry
          run: echo "${{ secrets.GITHUB_TOKEN }}" | docker login ghcr.io -u ${{ github.actor }} --password-stdin

        - name: âœ¨ Build Docker Image
          uses: docker/build-push-action@v6
          with:
            context: .
            file: ./Dockerfile
            push: true
            tags: ghcr.io/${{ github.repository }}/wisp:latest
